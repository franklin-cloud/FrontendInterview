## 地址栏输入地址都经历了哪些事?

1. URL 解析
   > 补全协议; 对参数进行 ASCII 转码;
2. DNS 解析

   > ‌DNS 解析是指将域名转换为 IP 地址的过程，使得用户可以通过易于记忆的域名访问互联网上的资源，而不是直接使用由计算机识别的 IP 地址。DNS（Domain Name System，域名系统）是互联网的核心服务之一，它作为一个分布式数据库，将域名和 IP 地址相互映射。‌
   > DNS 解析过程中涉及两种主要的查询方式：**‌ 递归查询 ‌** 和 **‌ 迭代查询 ‌**

   ```mermaid
   graph LR
   缓存和hosts文件 --> 查询本地DNS服务器 --> 查询根域名服务器 --> 查询顶级域名服务器 --> 返回结果并缓存下来
   ```

3. 建立 TCP 连接
   > 三次/四次握手的过程, SSL(Secure Socket Layer) 握手过程
4. 浏览器发送请求
   > 一旦建立 TCP 连接, 浏览器会就可以发送请求，地址栏输入网址后一般获取的资源类型都是 HTML。
5. 服务器处理请求后进行响应
   > 服务器处理请求并返回响应，响应头和响应体，响应头中包含状态码、内容类型、内容长度等信息，响应体中包含实际返回的数据，如 HTML、CSS、JavaScript、图片等资源。
6. 浏览器处理响应
   > 处理响应中的请求头和请求体, 这里包含状态码、缓存（强缓存 expire cache-control 和协商缓存 last-modif/if-modify-since etag/if-none-match）、content-type、cookie、connect 状态等。
7. 浏览器渲染页面

   > 文档解析会涉及到资源标识符 asnc defer preload prefetch
   > **HTML 解析**：得到 dom tree 和 cssom tree
   > **样式计算**：将 DOM 节点和 CSSOM 节点合并成 render tree
   > **布局**: 根据 render tree 计算每个元素在视口中的位置大小信息(x y witdh height), 得到布局树 layout tree。
   > **分层**: 将布局树 layout tree 中的节点按照层叠顺序进行分层，得到层叠上下文树，每个层叠上下文可以看做是一个独立的平面。
   > **绘制**: 根据布局树 layout tree 对每个层叠上下文生成绘制指令集，得到绘制指令列表。
   > **分块**: 将绘制指令列表中的绘制指令按照块进行划分，得到绘制块列表。
   > **光栅化**: 将绘制块列表中的绘制指令按照块进行光栅化，得到位图。
   > **画**: 将光栅化块列表中的光栅化块按照顺序进行绘制，得到最终的图像。

8. 根据 connect 状态来决定是否需要断开 TCP 连接（也就是四次挥手）
